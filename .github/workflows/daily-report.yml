name: ğŸ“§ Rapport Quotidien SmartExpiry

on:
  schedule:
    # Chaque jour Ã  8h du matin (heure UTC) = 10h heure de Paris
    - cron: '0 6 * * *'
  workflow_dispatch:  # Permet de dÃ©clencher manuellement

jobs:
  send-report:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ RÃ©cupÃ©rer le code
        uses: actions/checkout@v3
      
      - name: ğŸ Installer Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: ğŸ“¦ Installer les dÃ©pendances
        run: |
          python -m pip install --upgrade pip
          pip install firebase-admin pandas python-dateutil pytz
      
      - name: ğŸš€ Envoyer le rapport quotidien
        env:
          FIREBASE_CONFIG: ${{ secrets.FIREBASE_CONFIG }}
          SENDGRID_API_KEY: ${{ secrets.SENDGRID_API_KEY }}
          SENDGRID_FROM: ${{ secrets.SENDGRID_FROM }}
          SENDGRID_TO: ${{ secrets.SENDGRID_TO }}
        run: |
          python send_daily_report.py
      
      - name: âœ… Rapport envoyÃ©
        if: success()
        run: echo "âœ… Rapport quotidien envoyÃ© avec succÃ¨s"
      
      - name: âŒ Erreur
        if: failure()
        run: echo "âŒ Erreur lors de l'envoi du rapport"
